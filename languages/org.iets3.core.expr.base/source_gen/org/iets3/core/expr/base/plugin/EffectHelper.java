package org.iets3.core.expr.base.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.iets3.core.expr.base.behavior.IMayHaveEffect__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class EffectHelper {

  private SNode node;

  public EffectHelper(SNode expr) {
    node = expr;
  }

  public boolean modifiesMutableState() {
    return SNodeOperations.isInstanceOf(node, CONCEPTS.IMayHaveEffect$Gp) && IMayHaveEffect__BehaviorDescriptor.effectDescriptor_id6GySMNjjWfO.invoke(SNodeOperations.cast(node, CONCEPTS.IMayHaveEffect$Gp)).modifiesState();
  }

  public boolean readsMutableState() {
    return SNodeOperations.isInstanceOf(node, CONCEPTS.IMayHaveEffect$Gp) && IMayHaveEffect__BehaviorDescriptor.effectDescriptor_id6GySMNjjWfO.invoke(SNodeOperations.cast(node, CONCEPTS.IMayHaveEffect$Gp)).onlyReadsState();
  }

  public boolean isPure() {
    return !(modifiesMutableState()) && !(readsMutableState());
  }

  public boolean readsOrModifiesMutableState() {
    return !(isPure());
  }

  public boolean isIdempotent() {
    return modifiesMutableState() && IMayHaveEffect__BehaviorDescriptor.effectDescriptor_id6GySMNjjWfO.invoke(SNodeOperations.cast(node, CONCEPTS.IMayHaveEffect$Gp)).isIdempotent();
  }

  public boolean isCacheable() {
    return isPure() || isIdempotent();
  }

  public static boolean allows(EffectDescriptor permission, SNode candidate) {
    if (!(SNodeOperations.isInstanceOf(candidate, CONCEPTS.IMayHaveEffect$Gp))) {
      return true;
    }
    return permission.allows(IMayHaveEffect__BehaviorDescriptor.effectDescriptor_id6GySMNjjWfO.invoke(SNodeOperations.cast(candidate, CONCEPTS.IMayHaveEffect$Gp)));
  }

  public static String allowsRead(SNode n, String errorMessage) {
    return (EffectHelper.allows(new EffectDescriptor(false, false, true), n) ? null : errorMessage);
  }


  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept IMayHaveEffect$Gp = MetaAdapterFactory.getInterfaceConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x6c21639b50c5f96eL, "org.iets3.core.expr.base.structure.IMayHaveEffect");
  }
}
